{
	"info": {
		"_postman_id": "72a7e324-6ec5-41cf-aaca-e1f0085cf2c6",
		"name": "NotificationDemo",
		"description": "Uses view-based endpoints (from `App/views`) to demonstrate resident + driver flow: login via /api/login, subscribe, driver schedule drive, resident inbox, request stop, driver views requested stops. Uses seeded users alice/bob.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "20616724",
		"_collection_link": "https://www.postman.com/manutd-3640/manutd-workspace/collection/766vte1/drive-notification-views-demo?action=share&source=collection_link&creator=20616724"
	},
	"item": [
		{
			"name": "Resident - Alice",
			"item": [
				{
					"name": "Resident Login (alice) - views /api/login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Resident login status 200', function () { pm.response.to.have.status(200); });",
									"var json = pm.response.json();",
									"pm.expect(json).to.have.property('access_token');",
									"pm.environment.set('resident_token', json.access_token);",
									"if(json && json.access_token){ pm.environment.set('ACCESS_TOKEN', json.access_token); }"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"{{resident_username}}\",\n  \"password\": \"{{resident_password}}\"\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/api/login",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "Resident Subscribe To Driver",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('subscribe status 201', function(){ pm.response.to.have.status(201); });",
									"var json = pm.response.json();",
									"if(json && json.driver_id){ pm.environment.set('subscribed_driver_id', json.driver_id); }"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{resident_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"driver_id\": {{DRIVER_ID}}\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/resident/subscriptions",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"resident",
								"subscriptions"
							]
						}
					},
					"response": []
				},
				{
					"name": "Resident Check Inbox",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('inbox status 200', function () { pm.response.to.have.status(200); });",
									"var json = pm.response.json();",
									"pm.test('inbox has items', function(){ pm.expect(json).to.have.property('items'); pm.expect(json.items.length).to.be.above(0); });",
									"var items = json.items || [];",
									"var found = false;",
									"for(var i=0;i<items.length;i++){ if(items[i].indexOf('Drive ' + pm.environment.get('created_drive_id'))!==-1){ found=true; break; } }",
									"pm.test('inbox contains drive notification', function(){ pm.expect(found).to.be.true; });"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{resident_token}}"
							}
						],
						"url": {
							"raw": "{{BASE_URL}}/resident/inbox",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"resident",
								"inbox"
							]
						}
					},
					"response": []
				},
				{
					"name": "Resident Request Stop (for created drive)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('request stop status 201', function () { pm.response.to.have.status(201); });",
									"var json = pm.response.json();",
									"if(json && json.id){ pm.environment.set('created_stop_id', json.id); }"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{resident_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"drive_id\": {{created_drive_id}}\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/resident/stops",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"resident",
								"stops"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Driver - Bob",
			"item": [
				{
					"name": "Driver Login (bob) - views /api/login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Driver login status 200', function () { pm.response.to.have.status(200); });",
									"var json = pm.response.json();",
									"pm.expect(json).to.have.property('access_token');",
									"pm.environment.set('driver_token', json.access_token);",
									"if(json && json.access_token){ pm.environment.set('ACCESS_TOKEN', json.access_token); }"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"{{driver_username}}\",\n  \"password\": \"{{driver_password}}\"\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/api/login",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "Driver Create/Schedule Drive",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('create drive status 201', function () { pm.response.to.have.status(201); });",
									"var json = pm.response.json();",
									"if(json && json.id){ pm.environment.set('created_drive_id', json.id); }",
									"else if(json && json.driveId){ pm.environment.set('created_drive_id', json.driveId); }"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{driver_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"area_id\": {{AREA_ID}},\n  \"street_id\": {{STREET_ID}},\n  \"date\": \"2025-12-10\",\n  \"time\": \"09:00\"\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/driver/drives",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"driver",
								"drives"
							]
						}
					},
					"response": []
				},
				{
					"name": "Driver View Requested Stops",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('requested-stops status 200', function () { pm.response.to.have.status(200); });",
									"var json = pm.response.json();",
									"pm.test('requested stops contains created_stop_id', function(){ var ids = (json.items||[]).map(function(i){ return i.id; }); pm.expect(ids).to.include(parseInt(pm.environment.get('created_stop_id'))); });"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{driver_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"drive_id\": {{created_drive_id}}\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/driver/drives/requested-stops",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"driver",
								"drives",
								"requested-stops"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Driver - Ken",
			"item": [
				{
					"name": "Driver Login (bob) - views /api/login Copy",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Driver login status 200', function () { pm.response.to.have.status(200); });",
									"var json = pm.response.json();",
									"pm.expect(json).to.have.property('access_token');",
									"pm.environment.set('driver_token', json.access_token);",
									"if(json && json.access_token){ pm.environment.set('ACCESS_TOKEN', json.access_token); }"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"{{driver_username}}\",\n  \"password\": \"{{driver_password}}\"\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/api/login",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "Driver Create/Schedule Drive Copy",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('create drive status 201', function () { pm.response.to.have.status(201); });",
									"var json = pm.response.json();",
									"if(json && json.id){ pm.environment.set('created_drive_id', json.id); }",
									"else if(json && json.driveId){ pm.environment.set('created_drive_id', json.driveId); }"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{driver_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"area_id\": {{AREA_ID}},\n  \"street_id\": {{STREET_ID}},\n  \"date\": \"2025-12-10\",\n  \"time\": \"09:00\"\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/driver/drives",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"driver",
								"drives"
							]
						}
					},
					"response": []
				}
			]
		}
	]
}